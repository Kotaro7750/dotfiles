# ----------
# General
# ----------

# Vim mode
bindkey -v

## --- Vim prompt ---
#function zle-line-init zle-keymap-select {
#  case $KEYMAP in
#    vicmd)
#    PROMPT="%F{green}[%W %T]%/ %f"$'\n'"${vcs_info_msg_0_}%n@%m/%F{blue}NOR%f> "
#    ;;
#    main|viins)
#    PROMPT="%F{green}[%W %T]%/ %f"$'\n'"${vcs_info_msg_0_}%n@%m/%F{green}INS%f> "
#    ;;
#  esac
#  zle reset-prompt
#}
#zle -N zle-line-init
#zle -N zle-keymap-select
#
## --- Git prompt ---
#autoload -Uz vcs_info
#setopt prompt_subst 
#
#zstyle ':vcs_info:git:*' check-for-changes true
#zstyle ':vcs_info:git:*' stagedstr "%F{blue}A%f"
#zstyle ':vcs_info:git:*' unstagedstr "%F{cyan}M%f"
#zstyle ':vcs_info:*' formats "%F{yellow}[%b]%f %u%c "
#zstyle ':vcs_info:*' actionformats "%F{red}[%b]%f %u%c "
#
#precmd(){ vcs_info }

# --- Auto completion ---
autoload -U compinit
compinit

autoload -U bashcompinit
bashcompinit

# --- History search
function peco-select-history() {
  BUFFER=$(\history -n -r 1 | peco --query "$LBUFFER")
  CURSOR=$#BUFFER
  zle clear-screen
}
zle -N peco-select-history
bindkey '^r' peco-select-history

# ----------
# Alias
# ----------

# ----------
# Environment Variable pre plugin install
# ----------
export PATH=/usr/local/bin:/usr/bin:$HOME/bin/:$PATH

XDG_CONFIG_HOME=~/.config/

# PATH_DIR(実体はdotfile/zsh/path)以下にあるファイル内を全てsourceする
# PATH_DIRはgitで追跡されないのでユーザー固有の環境変数等を個別で設定するために使う
PRE_PATH_DIR=~/.zsh_path/pre
if [ -n "$(ls $PRE_PATH_DIR )" ]; then
  for path_file in $PRE_PATH_DIR/*; do
    source $path_file
  done
fi

# ----------
# Plugin
# ----------
source $ZPLUG_HOME/init.zsh

# --- zsh-syntax-highlighting ---
autoload -Uz colors
colors

zplug "zsh-users/zsh-syntax-highlighting", defer:3
ZSH_HIGHLIGHT_HIGHLIGHTERS=(main brackets)

case ${OSTYPE} in
  darwin* )
#OSによってコメントアウトを変える
    export LSCOLORS=fxgxcxdxbxegedabagacad
    alias ls='ls -G'
    ;;    
  linux* )
    eval $(dircolors ~/ls_color/dircolors-solarized/dircolors.ansi-universal)
    alias ls='ls --color'
    ;;

esac

# --- zsh-completions ---
zplug "zsh-users/zsh-completions"

# --- zsh-autosuggestions ---
zplug "zsh-users/zsh-autosuggestions"


# プラグインが無かったらインストールする
if ! zplug check --verbose; then
  printf 'Install? [y/N]: '
  if read -q; then
    echo; zplug install
  fi
fi

zplug load --verbose

# ----------
# Environment Variable post plugin install
# ----------
POST_PATH_DIR=~/.zsh_path/post
if [ -n "$(ls $POST_PATH_DIR )" ]; then
  for path_file in $POST_PATH_DIR/*; do
    source $path_file
  done
fi

export STARSHIP_CONFIG=~/.starship.toml
eval "$(starship init zsh)"
